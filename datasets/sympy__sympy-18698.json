{
  "instance_id": "sympy__sympy-18698",
  "problem_statement": "sqf and sqf_list output is not consistant\nThe example below is wrong in the sense that we should have (x*_2 - 5_x + 6, 3) and not 2 factors of multiplicity 3.\n\n```\n>  sqf_list(  (x**2 + 1)  * (x - 1)**2 * (x - 2)**3 * (x - 3)**3  )\n\n>  (1, [(x**2 + 1, 1), (x - 1, 2), (x - 3, 3), (x - 2, 3)])\n```\n\nwhereas below is correct --- one factor of multiplicity 2\n\n```\n>  sqf_list( x**5 - 2*x**4 - 2*x**3 + 4*x**2 + x - 2 )\n\n>  (1, [(x - 2, 1), (x**2 - 1, 2)])\n```\n\n",
  "localized_code": "[start of sympy/polys/polytools.py]\n1: \"\"\"User-friendly public interface to polynomial functions. \"\"\"\n2: \n3: from __future__ import print_function, division\n4: \n5: from functools import wraps\n6: \n7: from sympy.core import (\n8:     S, Basic, Expr, I, Integer, Add, Mul, Dummy, Tuple\n9: )\n10: from sympy.core.basic import preorder_traversal\n11: from sympy.core.compatibility import iterable, ordered\n12: from sympy.core.decorators import _sympifyit\n13: from sympy.core.function import Derivative\n14: from sympy.core.mul import _keep_coeff\n15: from sympy.core.relational import Relational\n16: from sympy.core.symbol import Symbol\n17: from sympy.core.sympify import sympify, _sympify\n18: from sympy.logic.boolalg import BooleanAtom\n19: from sympy.polys import polyoptions as options\n20: from sympy.polys.constructor import construct_domain\n21: from sympy.polys.domains import FF, QQ, ZZ\n22: from sympy.polys.fglmtools import matrix_fglm\n23: from sympy.polys.groebnertools import groebner as _groebner\n24: from sympy.polys.monomials import Monomial\n25: from sympy.polys.orderings import monomial_key\n26: from sympy.polys.polyclasses import DMP\n27: from sympy.polys.polyerrors import (\n28:     OperationNotSupported, DomainError,\n29:     CoercionFailed, UnificationFailed,\n30:     GeneratorsNeeded, PolynomialError,\n31:     MultivariatePolynomialError,\n32:     ExactQuotientFailed,\n33:     PolificationFailed,\n34:     ComputationFailed,\n35:     GeneratorsError,\n36: )\n37: from sympy.polys.polyutils import (\n38:     basic_from_dict,\n39:     _sort_gens,\n40:     _unify_gens,\n41:     _dict_reorder,\n42:     _dict_from_expr,\n43:     _parallel_dict_from_expr,\n44: )\n45: from sympy.polys.rationaltools import together\n46: from sympy.polys.rootisolation import dup_isolate_real_roots_list\n47: from sympy.utilities import group, sift, public, filldedent\n48: from sympy.utilities.exceptions import SymPyDeprecationWarning\n49: \n50: # Required to avoid errors\n51: import sympy.polys\n52: \n53: import mpmath\n54: from mpmath.libmp.libhyper import NoConvergence\n55: \n56: \n57: \n58: def _polifyit(func):\nCode replaced for brevity.\n83: \n84: \n85: \n86: \n87: @public\n88: class Poly(Basic):\nCode replaced for brevity.\n4152: \n4153: \n4154: \n4155: @public\n4156: class PurePoly(Poly):\nCode replaced for brevity.\n4246: \n4247: \n4248: \n4249: @public\n4250: def poly_from_expr(expr, *gens, **args):\nCode replaced for brevity.\n4253: \n4254: \n4255: \n4256: def _poly_from_expr(expr, opt):\nCode replaced for brevity.\n4293: \n4294: \n4295: \n4296: @public\n4297: def parallel_poly_from_expr(exprs, *gens, **args):\nCode replaced for brevity.\n4300: \n4301: \n4302: \n4303: def _parallel_poly_from_expr(exprs, opt):\nCode replaced for brevity.\n4395: \n4396: \n4397: \n4398: def _update_args(args, key, value):\nCode replaced for brevity.\n4405: \n4406: \n4407: \n4408: @public\n4409: def degree(f, gen=0):\nCode replaced for brevity.\n4464: \n4465: \n4466: \n4467: @public\n4468: def total_degree(f, *gens):\nCode replaced for brevity.\n4517: \n4518: \n4519: \n4520: @public\n4521: def degree_list(f, *gens, **args):\nCode replaced for brevity.\n4544: \n4545: \n4546: \n4547: @public\n4548: def LC(f, *gens, **args):\nCode replaced for brevity.\n4569: \n4570: \n4571: \n4572: @public\n4573: def LM(f, *gens, **args):\nCode replaced for brevity.\n4595: \n4596: \n4597: \n4598: @public\n4599: def LT(f, *gens, **args):\nCode replaced for brevity.\n4621: \n4622: \n4623: \n4624: @public\n4625: def pdiv(f, g, *gens, **args):\nCode replaced for brevity.\n4651: \n4652: \n4653: \n4654: @public\n4655: def prem(f, g, *gens, **args):\nCode replaced for brevity.\n4681: \n4682: \n4683: \n4684: @public\n4685: def pquo(f, g, *gens, **args):\nCode replaced for brevity.\n4716: \n4717: \n4718: \n4719: @public\n4720: def pexquo(f, g, *gens, **args):\nCode replaced for brevity.\n4751: \n4752: \n4753: \n4754: @public\n4755: def div(f, g, *gens, **args):\nCode replaced for brevity.\n4783: \n4784: \n4785: \n4786: @public\n4787: def rem(f, g, *gens, **args):\nCode replaced for brevity.\n4815: \n4816: \n4817: \n4818: @public\n4819: def quo(f, g, *gens, **args):\nCode replaced for brevity.\n4847: \n4848: \n4849: \n4850: @public\n4851: def exquo(f, g, *gens, **args):\nCode replaced for brevity.\n4882: \n4883: \n4884: \n4885: @public\n4886: def half_gcdex(f, g, *gens, **args):\nCode replaced for brevity.\n4921: \n4922: \n4923: \n4924: @public\n4925: def gcdex(f, g, *gens, **args):\nCode replaced for brevity.\n4960: \n4961: \n4962: \n4963: @public\n4964: def invert(f, g, *gens, **args):\nCode replaced for brevity.\n5014: \n5015: \n5016: \n5017: @public\n5018: def subresultants(f, g, *gens, **args):\nCode replaced for brevity.\n5044: \n5045: \n5046: \n5047: @public\n5048: def resultant(f, g, *gens, **args):\nCode replaced for brevity.\n5082: \n5083: \n5084: \n5085: @public\n5086: def discriminant(f, *gens, **args):\nCode replaced for brevity.\n5112: \n5113: \n5114: \n5115: @public\n5116: def cofactors(f, g, *gens, **args):\nCode replaced for brevity.\n5153: \n5154: \n5155: \n5156: @public\n5157: def gcd_list(seq, *gens, **args):\nCode replaced for brevity.\n5237: \n5238: \n5239: \n5240: @public\n5241: def gcd(f, g=None, *gens, **args):\nCode replaced for brevity.\n5288: \n5289: \n5290: \n5291: @public\n5292: def lcm_list(seq, *gens, **args):\nCode replaced for brevity.\n5366: \n5367: \n5368: \n5369: @public\n5370: def lcm(f, g=None, *gens, **args):\nCode replaced for brevity.\n5417: \n5418: \n5419: \n5420: @public\n5421: def terms_gcd(f, *gens, **args):\nCode replaced for brevity.\n5536: \n5537: \n5538: \n5539: @public\n5540: def trunc(f, p, *gens, **args):\nCode replaced for brevity.\n5566: \n5567: \n5568: \n5569: @public\n5570: def monic(f, *gens, **args):\nCode replaced for brevity.\n5596: \n5597: \n5598: \n5599: @public\n5600: def content(f, *gens, **args):\nCode replaced for brevity.\n5621: \n5622: \n5623: \n5624: @public\n5625: def primitive(f, *gens, **args):\nCode replaced for brevity.\n5667: \n5668: \n5669: \n5670: @public\n5671: def compose(f, g, *gens, **args):\nCode replaced for brevity.\n5697: \n5698: \n5699: \n5700: @public\n5701: def decompose(f, *gens, **args):\nCode replaced for brevity.\n5727: \n5728: \n5729: \n5730: @public\n5731: def sturm(f, *gens, **args):\nCode replaced for brevity.\n5757: \n5758: \n5759: \n5760: @public\n5761: def gff_list(f, *gens, **args):\nCode replaced for brevity.\n5804: \n5805: \n5806: \n5807: @public\n5808: def gff(f, *gens, **args):\nCode replaced for brevity.\n5810: \n5811: \n5812: \n5813: @public\n5814: def sqf_norm(f, *gens, **args):\nCode replaced for brevity.\n5844: \n5845: \n5846: \n5847: @public\n5848: def sqf_part(f, *gens, **args):\nCode replaced for brevity.\n5874: \n5875: \n5876: \n5877: def _sorted_factors(factors, method):\nCode replaced for brevity.\n5890: \n5891: \n5892: \n5893: def _factors_product(factors):\nCode replaced for brevity.\n5895: \n5896: \n5897: \n5898: def _symbolic_factor_list(expr, opt, method):\n5899:     \"\"\"Helper function for :func:`_symbolic_factor`. \"\"\"\n5900:     coeff, factors = S.One, []\n5901: \n5902:     args = [i._eval_factor() if hasattr(i, '_eval_factor') else i\n5903:         for i in Mul.make_args(expr)]\n5904:     for arg in args:\n5905:         if arg.is_Number:\n5906:             coeff *= arg\n5907:             continue\n5908:         if arg.is_Mul:\n5909:             args.extend(arg.args)\n5910:             continue\n5911:         if arg.is_Pow:\n5912:             base, exp = arg.args\n5913:             if base.is_Number and exp.is_Number:\n5914:                 coeff *= arg\n5915:                 continue\n5916:             if base.is_Number:\n5917:                 factors.append((base, exp))\n5918:                 continue\n5919:         else:\n5920:             base, exp = arg, S.One\n5921: \n5922:         try:\n5923:             poly, _ = _poly_from_expr(base, opt)\n5924:         except PolificationFailed as exc:\n5925:             factors.append((exc.expr, exp))\n5926:         else:\n5927:             func = getattr(poly, method + '_list')\n5928: \n5929:             _coeff, _factors = func()\n5930:             if _coeff is not S.One:\n5931:                 if exp.is_Integer:\n5932:                     coeff *= _coeff**exp\n5933:                 elif _coeff.is_positive:\n5934:                     factors.append((_coeff, exp))\n5935:                 else:\n5936:                     _factors.append((_coeff, S.One))\n5937: \n5938:             if exp is S.One:\n5939:                 factors.extend(_factors)\n5940:             elif exp.is_integer:\n5941:                 factors.extend([(f, k*exp) for f, k in _factors])\n5942:             else:\n5943:                 other = []\n5944: \n5945:                 for f, k in _factors:\n5946:                     if f.as_expr().is_positive:\n5947:                         factors.append((f, k*exp))\n5948:                     else:\n5949:                         other.append((f, k))\n5950: \n5951:                 factors.append((_factors_product(other), exp))\n5952: \n5953:     return coeff, factors\n5954: \n5955: \n5956: def _symbolic_factor(expr, opt, method):\nCode replaced for brevity.\n5968: \n5969: \n5970: \n5971: def _generic_factor_list(expr, gens, args, method):\nCode replaced for brevity.\n6012: \n6013: \n6014: \n6015: def _generic_factor(expr, gens, args, method):\nCode replaced for brevity.\n6021: \n6022: \n6023: \n6024: def to_rational_coeffs(f):\nCode replaced for brevity.\n6156: \n6157: \n6158: \n6159: def _torational_factor_list(p, x):\nCode replaced for brevity.\n6200: \n6201: \n6202: \n6203: @public\n6204: def sqf_list(f, *gens, **args):\nCode replaced for brevity.\n6218: \n6219: \n6220: \n6221: @public\n6222: def sqf(f, *gens, **args):\nCode replaced for brevity.\n6236: \n6237: \n6238: \n6239: @public\n6240: def factor_list(f, *gens, **args):\nCode replaced for brevity.\n6254: \n6255: \n6256: \n6257: @public\n6258: def factor(f, *gens, **args):\nCode replaced for brevity.\n6355: \n6356: \n6357: \n6358: @public\n6359: def intervals(F, all=False, eps=None, inf=None, sup=None, strict=False, fast=False, sqf=False):\nCode replaced for brevity.\n6411: \n6412: \n6413: \n6414: @public\n6415: def refine_root(f, s, t, eps=None, steps=None, fast=False, check_sqf=False):\nCode replaced for brevity.\n6435: \n6436: \n6437: \n6438: @public\n6439: def count_roots(f, inf=None, sup=None):\nCode replaced for brevity.\n6463: \n6464: \n6465: \n6466: @public\n6467: def real_roots(f, multiple=True):\nCode replaced for brevity.\n6487: \n6488: \n6489: \n6490: @public\n6491: def nroots(f, n=15, maxsteps=50, cleanup=True):\nCode replaced for brevity.\n6513: \n6514: \n6515: \n6516: @public\n6517: def ground_roots(f, *gens, **args):\nCode replaced for brevity.\n6538: \n6539: \n6540: \n6541: @public\n6542: def nth_power_roots_poly(f, n, *gens, **args):\nCode replaced for brevity.\n6577: \n6578: \n6579: \n6580: @public\n6581: def cancel(f, *gens, **args):\nCode replaced for brevity.\n6664: \n6665: \n6666: \n6667: @public\n6668: def reduced(f, G, *gens, **args):\nCode replaced for brevity.\n6724: \n6725: \n6726: \n6727: @public\n6728: def groebner(F, *gens, **args):\nCode replaced for brevity.\n6778: \n6779: \n6780: \n6781: @public\n6782: def is_zero_dimensional(F, *gens, **args):\nCode replaced for brevity.\n6796: \n6797: \n6798: \n6799: @public\n6800: class GroebnerBasis(Basic):\nCode replaced for brevity.\n7069: \n7070: \n7071: \n7072: @public\n7073: def poly(expr, *gens, **args):\nCode replaced for brevity.\n7151: \n\n",
  "line_level_localization": [
    {
      "filename": "/sympy/polys/polytools.py",
      "suspect_lines": [
        5,
        5908,
        5909,
        5910,
        5911
      ]
    }
  ]
}