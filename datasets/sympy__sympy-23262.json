{
  "instance_id": "sympy__sympy-23262",
  "problem_statement": "Python code printer not respecting tuple with one element\nHi,\r\n\r\nThanks for the recent updates in SymPy! I'm trying to update my code to use SymPy 1.10 but ran into an issue with the Python code printer. MWE:\r\n\r\n\r\n```python\r\nimport inspect\r\nfrom sympy import lambdify\r\n\r\ninspect.getsource(lambdify([], tuple([1])))\r\n```\r\nSymPy 1.9 and under outputs:\r\n```\r\n'def _lambdifygenerated():\\n    return (1,)\\n'\r\n```\r\n\r\nBut SymPy 1.10 gives\r\n\r\n```\r\n'def _lambdifygenerated():\\n    return (1)\\n'\r\n```\r\nNote the missing comma after `1` that causes an integer to be returned instead of a tuple. \r\n\r\nFor tuples with two or more elements, the generated code is correct:\r\n```python\r\ninspect.getsource(lambdify([], tuple([1, 2])))\r\n```\r\nIn SymPy  1.10 and under, outputs:\r\n\r\n```\r\n'def _lambdifygenerated():\\n    return (1, 2)\\n'\r\n```\r\nThis result is expected.\r\n\r\nNot sure if this is a regression. As this breaks my program which assumes the return type to always be a tuple, could you suggest a workaround from the code generation side? Thank you. \n",
  "localized_code": "[start of sympy/utilities/lambdify.py]\n1: \"\"\"\n2: This module provides convenient functions to transform SymPy expressions to\n3: lambda functions which can be used to calculate numerical values very fast.\n4: \"\"\"\n5: \n6: from typing import Any, Dict as tDict, Iterable, Union as tUnion, TYPE_CHECKING\n7: \n8: import builtins\n9: import inspect\n10: import keyword\n11: import textwrap\n12: import linecache\n13: \n14: # Required despite static analysis claiming it is not used\n15: from sympy.external import import_module # noqa:F401\n16: from sympy.utilities.exceptions import sympy_deprecation_warning\n17: from sympy.utilities.decorator import doctest_depends_on\n18: from sympy.utilities.iterables import (is_sequence, iterable,\n19:     NotIterable, flatten)\n20: from sympy.utilities.misc import filldedent\n21: \n22: \n23: if TYPE_CHECKING:\n24:     import sympy.core.expr\n25: \n26: __doctest_requires__ = {('lambdify',): ['numpy', 'tensorflow']}\n27: \n28: # Default namespaces, letting us define translations that can't be defined\n29: # by simple variable maps, like I => 1j\n30: MATH_DEFAULT = {}  # type: tDict[str, Any]\n31: MPMATH_DEFAULT = {}  # type: tDict[str, Any]\n32: NUMPY_DEFAULT = {\"I\": 1j}  # type: tDict[str, Any]\n33: SCIPY_DEFAULT = {\"I\": 1j}  # type: tDict[str, Any]\n34: CUPY_DEFAULT = {\"I\": 1j}  # type: tDict[str, Any]\n35: TENSORFLOW_DEFAULT = {}  # type: tDict[str, Any]\n36: SYMPY_DEFAULT = {}  # type: tDict[str, Any]\n37: NUMEXPR_DEFAULT = {}  # type: tDict[str, Any]\n38: \n39: # These are the namespaces the lambda functions will use.\n40: # These are separate from the names above because they are modified\n41: # throughout this file, whereas the defaults should remain unmodified.\n42: \n43: MATH = MATH_DEFAULT.copy()\n44: MPMATH = MPMATH_DEFAULT.copy()\n45: NUMPY = NUMPY_DEFAULT.copy()\n46: SCIPY = SCIPY_DEFAULT.copy()\n47: CUPY = CUPY_DEFAULT.copy()\n48: TENSORFLOW = TENSORFLOW_DEFAULT.copy()\n49: SYMPY = SYMPY_DEFAULT.copy()\n50: NUMEXPR = NUMEXPR_DEFAULT.copy()\n51: \n52: \n53: # Mappings between SymPy and other modules function names.\n54: MATH_TRANSLATIONS = {\n55:     \"ceiling\": \"ceil\",\n56:     \"E\": \"e\",\n57:     \"ln\": \"log\",\n58: }\n59: \n60: # NOTE: This dictionary is reused in Function._eval_evalf to allow subclasses\n61: # of Function to automatically evalf.\n62: MPMATH_TRANSLATIONS = {\n63:     \"Abs\": \"fabs\",\n64:     \"elliptic_k\": \"ellipk\",\n65:     \"elliptic_f\": \"ellipf\",\n66:     \"elliptic_e\": \"ellipe\",\n67:     \"elliptic_pi\": \"ellippi\",\n68:     \"ceiling\": \"ceil\",\n69:     \"chebyshevt\": \"chebyt\",\n70:     \"chebyshevu\": \"chebyu\",\n71:     \"E\": \"e\",\n72:     \"I\": \"j\",\n73:     \"ln\": \"log\",\n74:     #\"lowergamma\":\"lower_gamma\",\n75:     \"oo\": \"inf\",\n76:     #\"uppergamma\":\"upper_gamma\",\n77:     \"LambertW\": \"lambertw\",\n78:     \"MutableDenseMatrix\": \"matrix\",\n79:     \"ImmutableDenseMatrix\": \"matrix\",\n80:     \"conjugate\": \"conj\",\n81:     \"dirichlet_eta\": \"altzeta\",\n82:     \"Ei\": \"ei\",\n83:     \"Shi\": \"shi\",\n84:     \"Chi\": \"chi\",\n85:     \"Si\": \"si\",\n86:     \"Ci\": \"ci\",\n87:     \"RisingFactorial\": \"rf\",\n88:     \"FallingFactorial\": \"ff\",\n89:     \"betainc_regularized\": \"betainc\",\n90: }\n91: \n92: NUMPY_TRANSLATIONS = {\n93:     \"Heaviside\": \"heaviside\",\n94:     }  # type: tDict[str, str]\n95: SCIPY_TRANSLATIONS = {}  # type: tDict[str, str]\n96: CUPY_TRANSLATIONS = {}  # type: tDict[str, str]\n97: \n98: TENSORFLOW_TRANSLATIONS = {}  # type: tDict[str, str]\n99: \n100: NUMEXPR_TRANSLATIONS = {}  # type: tDict[str, str]\n101: \n102: # Available modules:\n103: MODULES = {\n104:     \"math\": (MATH, MATH_DEFAULT, MATH_TRANSLATIONS, (\"from math import *\",)),\n105:     \"mpmath\": (MPMATH, MPMATH_DEFAULT, MPMATH_TRANSLATIONS, (\"from mpmath import *\",)),\n106:     \"numpy\": (NUMPY, NUMPY_DEFAULT, NUMPY_TRANSLATIONS, (\"import numpy; from numpy import *; from numpy.linalg import *\",)),\n107:     \"scipy\": (SCIPY, SCIPY_DEFAULT, SCIPY_TRANSLATIONS, (\"import numpy; import scipy; from scipy import *; from scipy.special import *\",)),\n108:     \"cupy\": (CUPY, CUPY_DEFAULT, CUPY_TRANSLATIONS, (\"import cupy\",)),\n109:     \"tensorflow\": (TENSORFLOW, TENSORFLOW_DEFAULT, TENSORFLOW_TRANSLATIONS, (\"import tensorflow\",)),\n110:     \"sympy\": (SYMPY, SYMPY_DEFAULT, {}, (\n111:         \"from sympy.functions import *\",\n112:         \"from sympy.matrices import *\",\n113:         \"from sympy import Integral, pi, oo, nan, zoo, E, I\",)),\n114:     \"numexpr\" : (NUMEXPR, NUMEXPR_DEFAULT, NUMEXPR_TRANSLATIONS,\n115:                  (\"import_module('numexpr')\", )),\n116: }\n117: \n118: \n119: def _import(module, reload=False):\nCode replaced for brevity.\n173: \n174: \n175: \n176: # Used for dynamically generated filenames that are inserted into the\n177: # linecache.\n178: _lambdify_generated_counter = 1\n179: \n180: \n181: @doctest_depends_on(modules=('numpy', 'scipy', 'tensorflow',), python_version=(3,))\n182:              dummify=False, cse=False):\nCode replaced for brevity.\n923: \n924: \n925: def _module_present(modname, modlist):\nCode replaced for brevity.\n931: \n932: \n933: def _get_namespace(m):\nCode replaced for brevity.\n945: \n946: \n947: \n948: def _recursive_to_string(doprint, arg):\n949:     \"\"\"Functions in lambdify accept both SymPy types and non-SymPy types such as python\n950:     lists and tuples. This method ensures that we only call the doprint method of the\n951:     printer with SymPy types (so that the printer safely can use SymPy-methods).\"\"\"\n952:     from sympy.matrices.common import MatrixOperations\n953:     from sympy.core.basic import Basic\n954: \n955:     if isinstance(arg, (Basic, MatrixOperations)):\n956:         return doprint(arg)\n957:     elif iterable(arg):\n958:         if isinstance(arg, list):\n959:             left, right = \"[]\"\n960:         elif isinstance(arg, tuple):\n961:             left, right = \"()\"\n962:         else:\n963:             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n964:         return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n965:     elif isinstance(arg, str):\n966:         return arg\n967:     else:\n968:         return doprint(arg)\n969: \n970: \n971: def lambdastr(args, expr, printer=None, dummify=None):\nCode replaced for brevity.\n1086: \n1087: \n1088: class _EvaluatorPrinter:\nCode replaced for brevity.\n1254: \n1255: \n1256: class _TensorflowEvaluatorPrinter(_EvaluatorPrinter):\nCode replaced for brevity.\n1279: \n1280: \n1281: def _imp_namespace(expr, namespace=None):\nCode replaced for brevity.\n1346: \n1347: \n1348: \n1349: def implemented_function(symfunc, implementation):\nCode replaced for brevity.\n1402: \n\n",
  "line_level_localization": [
    {
      "filename": "/sympy/utilities/lambdify.py",
      "suspect_lines": [
        959,
        961
      ]
    }
  ]
}