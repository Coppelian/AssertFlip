{
  "instance_id": "django__django-17029",
  "problem_statement": "Apps.clear_cache() does not clear get_swappable_settings_name cache.\nDescription\n\t\nWe use apps.clear_cache() in django-stubs to be able to reset the previous state on consequential mypy runs.\nCode: ​https://github.com/typeddjango/django-stubs/pull/1601/files#diff-c49d8fe2cd0a58fad3c36ab3a88c7745e9622f3098e60cd512953eb17b8a1994R63-R64\nBut, looks like we don't clear all the object's cache this way, because get_swappable_settings_name (which is a functools._lru_cache_wrapper) is not cleared.\nI think that this is not correct. .clear_cache doc states: Clear all internal caches, for methods that alter the app registry.\nLooks like that is not the case.\nI propose to add: self.get_swappable_settings_name.cache_clear() line to def clear_cache.\nIf others agree, I will make a PR.\nOriginal discussion: ​https://github.com/typeddjango/django-stubs/pull/1601#discussion_r1246344533\n",
  "localized_code": "[start of django/apps/registry.py]\n1: import functools\n2: import sys\n3: import threading\n4: import warnings\n5: from collections import Counter, defaultdict\n6: from functools import partial\n7: \n8: from django.core.exceptions import AppRegistryNotReady, ImproperlyConfigured\n9: \n10: from .config import AppConfig\n11: \n12: \n13: class Apps:\n14:     \"\"\"\n15:     A registry that stores the configuration of installed applications.\n16: \n17:     It also keeps track of models, e.g. to provide reverse relations.\n18:     \"\"\"\n19: \n20:     def __init__(self, installed_apps=()):\n21:         # installed_apps is set to None when creating the main registry\n22:         # because it cannot be populated at that point. Other registries must\n23:         # provide a list of installed apps and are populated immediately.\n24:         if installed_apps is None and hasattr(sys.modules[__name__], \"apps\"):\n25:             raise RuntimeError(\"You must supply an installed_apps argument.\")\n26: \n27:         # Mapping of app labels => model names => model classes. Every time a\n28:         # model is imported, ModelBase.__new__ calls apps.register_model which\n29:         # creates an entry in all_models. All imported models are registered,\n30:         # regardless of whether they're defined in an installed application\n31:         # and whether the registry has been populated. Since it isn't possible\n32:         # to reimport a module safely (it could reexecute initialization code)\n33:         # all_models is never overridden or reset.\n34:         self.all_models = defaultdict(dict)\n35: \n36:         # Mapping of labels to AppConfig instances for installed apps.\n37:         self.app_configs = {}\n38: \n39:         # Stack of app_configs. Used to store the current state in\n40:         # set_available_apps and set_installed_apps.\n41:         self.stored_app_configs = []\n42: \n43:         # Whether the registry is populated.\n44:         self.apps_ready = self.models_ready = self.ready = False\n45:         # For the autoreloader.\n46:         self.ready_event = threading.Event()\n47: \n48:         # Lock for thread-safe population.\n49:         self._lock = threading.RLock()\n50:         self.loading = False\n51: \n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/django/apps/registry.py",
      "suspect_lines": []
    }
  ]
}