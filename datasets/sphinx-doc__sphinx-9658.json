{
  "instance_id": "sphinx-doc__sphinx-9658",
  "problem_statement": "Inherited classes not correctly documented when mocked\n### Describe the bug\r\n\r\nWe're experiencing an issue when documenting classes that inherit mocked classes. However, classes which inherit other classes from our own package are ok.\r\n\r\nThis issue appears to be dependent on the `sphinx` version:\r\n\r\n- `sphinx<3.0`: Everything is OK. \r\n- `sphinx>=3.0 < 3.4.2`: Classes that inherit mocked classes are not documented. (see [sphinx #8164](https://github.com/sphinx-doc/sphinx/issues/8164)). This is fixed in `sphinx 3.4.2`. \r\n- `sphinx>=3.4.2`: The previously missing classes are now documented, but there is a problem with the \"Bases\" section in the docs. \r\n \r\nExample: In the docs for `alibi_detect.utils.pytorch.kernels.DeepKernel` in this readthedocs build https://seldon--338.org.readthedocs.build/projects/alibi-detect/en/338/api/alibi_detect.utils.pytorch.kernels.html, the base class is listed as \"Bases: `torch.nn.`\" instead of \"Bases: `torch.nn.Module`\". \r\n\r\n\r\n### How to Reproduce\r\n\r\n```\r\n$ git clone https://github.com/ascillitoe/alibi-detect.git\r\n$ cd alibi-detect\r\n$ pip install -r requirements/docs.txt\r\n$ make build_docs\r\n$ # open doc/_build/html/api/alibi_detect.utils.pytorch.kernels.html and see \"Bases\" section.\r\n```\r\n\r\n\r\n### Expected behavior\r\n\r\nThe \"Bases\" section should report `torch.nn.Module` not `torch.nn.`. \r\n\r\ni.e. see\r\nhttps://seldon--325.org.readthedocs.build/projects/alibi-detect/en/325/api/alibi_detect.utils.pytorch.kernels.html\r\n\r\n### Your project\r\n\r\nhttps://github.com/ascillitoe/alibi-detect/tree/feature_sphinx4\r\n\r\n### Screenshots\r\n\r\n### Screenshot with `sphinx==4.2`\r\n![sphinx_problem](https://user-images.githubusercontent.com/32061685/133816582-ca162b07-41c7-4b8e-98ea-781e7c659229.png)\r\n\r\n### Screenshot with `sphinx<3.0`\r\n![sphinx_working](https://user-images.githubusercontent.com/32061685/133816065-6291ce1b-96cf-4b0f-9648-7f993fc15611.png)\r\n\r\n\r\n\r\n### OS\r\n\r\nUbuntu 18.04 (used by readthedocs/build:6.0)\r\n\r\n### Python version\r\n\r\n3.8.11\r\n\r\n### Sphinx version\r\n\r\n`>=3.4.2`\r\n\r\n### Sphinx extensions\r\n\r\n    [\"sphinx.ext.autodoc\",\r\n    \"sphinx.ext.doctest\",\r\n    \"sphinx.ext.intersphinx\",\r\n    \"sphinx.ext.todo\",\r\n    \"sphinx.ext.coverage\",\r\n    \"sphinx.ext.mathjax\",\r\n    \"sphinx.ext.ifconfig\",\r\n    \"sphinx.ext.viewcode\",\r\n    \"sphinx.ext.napoleon\",\r\n    \"sphinx_autodoc_typehints\",\r\n    \"sphinxcontrib.apidoc\", \r\n    \"nbsphinx\",\r\n    \"nbsphinx_link\",  \r\n    \"myst_parser\"]\r\n\r\n\r\n### Extra tools\r\n\r\n_No response_\r\n\r\n### Additional context\r\n\r\ndemo PR:\r\nhttps://github.com/SeldonIO/alibi-detect/pull/338\r\n\r\nreadthedocs demo build:\r\nhttps://seldon--338.org.readthedocs.build/projects/alibi-detect/en/338/api/alibi_detect.utils.pytorch.kernels.html\r\n\r\n\n",
  "localized_code": "[start of sphinx/ext/autodoc/mock.py]\n1: \"\"\"\n2:     sphinx.ext.autodoc.mock\n3:     ~~~~~~~~~~~~~~~~~~~~~~~\n4: \n5:     mock for autodoc\n6: \n7:     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.\n8:     :license: BSD, see LICENSE for details.\n9: \"\"\"\n10: \n11: import contextlib\n12: import os\n13: import sys\n14: from importlib.abc import Loader, MetaPathFinder\n15: from importlib.machinery import ModuleSpec\n16: from types import ModuleType\n17: from typing import Any, Generator, Iterator, List, Optional, Sequence, Tuple, Union\n18: \n19: from sphinx.util import logging\n20: from sphinx.util.inspect import safe_getattr\n21: \n22: logger = logging.getLogger(__name__)\n23: \n24: \n25: class _MockObject:\n26:     \"\"\"Used by autodoc_mock_imports.\"\"\"\n27: \n28:     __display_name__ = '_MockObject'\n29:     __sphinx_mock__ = True\n30:     __sphinx_decorator_args__: Tuple[Any, ...] = ()\n31: \n32:     def __new__(cls, *args: Any, **kwargs: Any) -> Any:\n33:         if len(args) == 3 and isinstance(args[1], tuple):\n34:             superclass = args[1][-1].__class__\n35:             if superclass is cls:\n36:                 # subclassing MockObject\n37:                 return _make_subclass(args[0], superclass.__display_name__,\n38:                                       superclass=superclass, attributes=args[2])\n39: \n40:         return super().__new__(cls)\n41: \n42:     def __init__(self, *args: Any, **kwargs: Any) -> None:\n43:         self.__qualname__ = ''\n44: \n45:     def __len__(self) -> int:\n46:         return 0\n47: \n48:     def __contains__(self, key: str) -> bool:\n49:         return False\n50: \n51:     def __iter__(self) -> Iterator:\n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/sphinx/ext/autodoc/mock.py",
      "suspect_lines": [
        43
      ]
    }
  ]
}