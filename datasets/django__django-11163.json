{
  "instance_id": "django__django-11163",
  "problem_statement": "model_to_dict() should return an empty dict for an empty list of fields.\nDescription\n\t\nBeen called as model_to_dict(instance, fields=[]) function should return empty dict, because no fields were requested. But it returns all fields\nThe problem point is\nif fields and f.name not in fields:\nwhich should be\nif fields is not None and f.name not in fields:\nPR: â€‹https://github.com/django/django/pull/11150/files\n",
  "localized_code": "[start of django/forms/models.py]\n1: \"\"\"\n2: Helper functions for creating Form classes from Django models\n3: and database field objects.\n4: \"\"\"\n5: \n6: from itertools import chain\n7: \n8: from django.core.exceptions import (\n9:     NON_FIELD_ERRORS, FieldError, ImproperlyConfigured, ValidationError,\n10: )\n11: from django.forms.fields import ChoiceField, Field\n12: from django.forms.forms import BaseForm, DeclarativeFieldsMetaclass\n13: from django.forms.formsets import BaseFormSet, formset_factory\n14: from django.forms.utils import ErrorList\n15: from django.forms.widgets import (\n16:     HiddenInput, MultipleHiddenInput, SelectMultiple,\n17: )\n18: from django.utils.text import capfirst, get_text_list\n19: from django.utils.translation import gettext, gettext_lazy as _\n20: \n21: __all__ = (\n22:     'ModelForm', 'BaseModelForm', 'model_to_dict', 'fields_for_model',\n23:     'ModelChoiceField', 'ModelMultipleChoiceField', 'ALL_FIELDS',\n24:     'BaseModelFormSet', 'modelformset_factory', 'BaseInlineFormSet',\n25:     'inlineformset_factory', 'modelform_factory',\n26: )\n27: \n28: ALL_FIELDS = '__all__'\n29: \n30: \n31: def construct_instance(form, instance, fields=None, exclude=None):\n32:     \"\"\"\n33:     Construct and return a model instance from the bound ``form``'s\n34:     ``cleaned_data``, but do not save the returned instance to the database.\n35:     \"\"\"\n36:     from django.db import models\n37:     opts = instance._meta\n38: \n39:     cleaned_data = form.cleaned_data\n40:     file_field_list = []\n41:     for f in opts.fields:\n42:         if not f.editable or isinstance(f, models.AutoField) \\\n43:                 or f.name not in cleaned_data:\n44:             continue\n45:         if fields is not None and f.name not in fields:\n46:             continue\n47:         if exclude and f.name in exclude:\n48:             continue\n49:         # Leave defaults for fields that aren't in POST data, except for\n50:         # checkbox inputs because they don't appear in POST data if not checked.\n51:         if (f.has_default() and\n52:                 form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n53:             continue\n54:         # Defer saving file-type fields until after the other fields, so a\n55:         # callable upload_to can use the values from other fields.\n56:         if isinstance(f, models.FileField):\n57:             file_field_list.append(f)\n58:         else:\n59:             f.save_form_data(instance, cleaned_data[f.name])\n60: \n61:     for f in file_field_list:\n62:         f.save_form_data(instance, cleaned_data[f.name])\n63: \n64:     return instance\n65: \n66: \n67: # ModelForms #################################################################\n68: \n69: def model_to_dict(instance, fields=None, exclude=None):\n70:     \"\"\"\n71:     Return a dict containing the data in ``instance`` suitable for passing as\n72:     a Form's ``initial`` keyword argument.\n73: \n74:     ``fields`` is an optional list of field names. If provided, return only the\n75:     named.\n76: \n77:     ``exclude`` is an optional list of field names. If provided, exclude the\n78:     named from the returned dict, even if they are listed in the ``fields``\n79:     argument.\n80:     \"\"\"\n81:     opts = instance._meta\n82:     data = {}\n83:     for f in chain(opts.concrete_fields, opts.private_fields, opts.many_to_many):\n84:         if not getattr(f, 'editable', False):\n85:             continue\n86:         if fields and f.name not in fields:\n87:             continue\n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/django/forms/models.py",
      "suspect_lines": [
        86
      ]
    }
  ]
}