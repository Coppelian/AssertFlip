{
  "instance_id": "django__django-11490",
  "problem_statement": "Composed queries cannot change the list of columns with values()/values_list().\nDescription\n\t\nComposed queries cannot change the list of columns when values()/values_list() is evaluated multiple times, e.g.\n>>> ReservedName.objects.create(name='a', order=2)\n>>> qs1 = ReservedName.objects.all()\n>>> print(qs1.union(qs1).values_list('name', 'order').get())\n('a', 2)\n>>> print(qs1.union(qs1).values_list('order').get())\n('a', 2)\n(see â€‹compiler.py#L428-L433).\n",
  "localized_code": "[start of django/db/models/sql/compiler.py]\n1: import collections\n2: import re\n3: import warnings\n4: from itertools import chain\n5: \n6: from django.core.exceptions import EmptyResultSet, FieldError\n7: from django.db.models.constants import LOOKUP_SEP\n8: from django.db.models.expressions import OrderBy, Random, RawSQL, Ref, Value\n9: from django.db.models.functions import Cast\n10: from django.db.models.query_utils import QueryWrapper, select_related_descend\n11: from django.db.models.sql.constants import (\n12:     CURSOR, GET_ITERATOR_CHUNK_SIZE, MULTI, NO_RESULTS, ORDER_DIR, SINGLE,\n13: )\n14: from django.db.models.sql.query import Query, get_order_dir\n15: from django.db.transaction import TransactionManagementError\n16: from django.db.utils import DatabaseError, NotSupportedError\n17: from django.utils.deprecation import RemovedInDjango31Warning\n18: from django.utils.hashable import make_hashable\n19: \n20: FORCE = object()\n21: \n22: \n23: class SQLCompiler:\n24:     def __init__(self, query, connection, using):\n25:         self.query = query\n26:         self.connection = connection\n27:         self.using = using\n28:         self.quote_cache = {'*': '*'}\n29:         # The select, klass_info, and annotations are needed by QuerySet.iterator()\n30:         # these are set as a side-effect of executing the query. Note that we calculate\n31:         # separately a list of extra select columns needed for grammatical correctness\n32:         # of the query, but these columns are not included in self.select.\n33:         self.select = None\n34:         self.annotation_col_map = None\n35:         self.klass_info = None\n36:         # Multiline ordering SQL clause may appear from RawSQL.\n37:         self.ordering_parts = re.compile(r'^(.*)\\s(ASC|DESC)(.*)', re.MULTILINE | re.DOTALL)\n38:         self._meta_ordering = None\n39: \n40:     def setup_query(self):\n41:         if all(self.query.alias_refcount[a] == 0 for a in self.query.alias_map):\n42:             self.query.get_initial_alias()\n43:         self.select, self.klass_info, self.annotation_col_map = self.get_select()\n44:         self.col_count = len(self.select)\n45: \n46:     def pre_sql_setup(self):\n47:         \"\"\"\n48:         Do any necessary class setup immediately prior to producing SQL. This\n49:         is for things that can't necessarily be done in __init__ because we\n50:         might not have all the pieces in place at that time.\n51:         \"\"\"\n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/django/db/models/sql/compiler.py",
      "suspect_lines": []
    }
  ]
}