{
  "instance_id": "django__django-15103",
  "problem_statement": "Make the element_id argument of json_script optional\nDescription\n\t\nI recently had a use-case where I wanted to use json_script but I didn't need any id for it (I was including the <script> inside a <template> so I didn't need an id to refer to it).\nI can't see any reason (security or otherwise) for the id to be required and making it optional doesn't seem to break any tests.\n",
  "localized_code": "[start of django/template/defaultfilters.py]\n1: \"\"\"Default variable filters.\"\"\"\n2: import random as random_module\n3: import re\n4: import types\n5: from decimal import ROUND_HALF_UP, Context, Decimal, InvalidOperation\n6: from functools import wraps\n7: from operator import itemgetter\n8: from pprint import pformat\n9: from urllib.parse import quote\n10: \n11: from django.utils import formats\n12: from django.utils.dateformat import format, time_format\n13: from django.utils.encoding import iri_to_uri\n14: from django.utils.html import (\n15:     avoid_wrapping, conditional_escape, escape, escapejs,\n16:     json_script as _json_script, linebreaks, strip_tags, urlize as _urlize,\n17: )\n18: from django.utils.safestring import SafeData, mark_safe\n19: from django.utils.text import (\n20:     Truncator, normalize_newlines, phone2numeric, slugify as _slugify, wrap,\n21: )\n22: from django.utils.timesince import timesince, timeuntil\n23: from django.utils.translation import gettext, ngettext\n24: \n25: from .base import Variable, VariableDoesNotExist\n26: from .library import Library\n27: \n28: register = Library()\n29: \n30: \n31: #######################\n32: # STRING DECORATOR    #\n33: #######################\n34: \n35: def stringfilter(func):\n36:     \"\"\"\n37:     Decorator for filters which should only receive strings. The object\n38:     passed as the first positional argument will be converted to a string.\n39:     \"\"\"\n40:     def _dec(*args, **kwargs):\n41:         args = list(args)\n42:         args[0] = str(args[0])\n43:         if (isinstance(args[0], SafeData) and\n44:                 getattr(_dec._decorated_function, 'is_safe', False)):\n45:             return mark_safe(func(*args, **kwargs))\n46:         return func(*args, **kwargs)\n47: \n48:     # Include a reference to the real function (used to check original\n49:     # arguments by the template parser, and to bear the 'is_safe' attribute\n50:     # when multiple decorators are applied).\n51:     _dec._decorated_function = getattr(func, '_decorated_function', func)\n52: \n53:     return wraps(func)(_dec)\n54: \n55: \n56: ###################\n57: # STRINGS         #\n58: ###################\n59: \n60: @register.filter(is_safe=True)\n61: @stringfilter\n62: def addslashes(value):\nCode replaced for brevity.\n68: \n69: \n70: \n71: @register.filter(is_safe=True)\n72: @stringfilter\n73: def capfirst(value):\nCode replaced for brevity.\n75: \n76: \n77: \n78: @register.filter(\"escapejs\")\n79: @stringfilter\n80: def escapejs_filter(value):\nCode replaced for brevity.\n82: \n83: \n84: \n85: @register.filter(is_safe=True)\n86: def json_script(value, element_id):\n87:     \"\"\"\n88:     Output value JSON-encoded, wrapped in a <script type=\"application/json\">\n89:     tag.\n90:     \"\"\"\n91:     return _json_script(value, element_id)\n92: \n93: \n94: @register.filter(is_safe=True)\n... Code Truncated ...\n\n[start of django/utils/html.py]\n1: \"\"\"HTML utilities suitable for global use.\"\"\"\n2: \n3: import html\n4: import json\n5: import re\n6: from html.parser import HTMLParser\n7: from urllib.parse import (\n8:     parse_qsl, quote, unquote, urlencode, urlsplit, urlunsplit,\n9: )\n10: \n11: from django.utils.encoding import punycode\n12: from django.utils.functional import Promise, keep_lazy, keep_lazy_text\n13: from django.utils.http import RFC3986_GENDELIMS, RFC3986_SUBDELIMS\n14: from django.utils.regex_helper import _lazy_re_compile\n15: from django.utils.safestring import SafeData, SafeString, mark_safe\n16: from django.utils.text import normalize_newlines\n17: \n18: \n19: @keep_lazy(str, SafeString)\n20: def escape(text):\n21:     \"\"\"\n22:     Return the given text with ampersands, quotes and angle brackets encoded\n23:     for use in HTML.\n24: \n25:     Always escape input, even if it's already escaped and marked as such.\n26:     This may result in double-escaping. If this is a concern, use\n27:     conditional_escape() instead.\n28:     \"\"\"\n29:     return mark_safe(html.escape(str(text)))\n30: \n31: \n32: _js_escapes = {\n33:     ord('\\\\'): '\\\\u005C',\n34:     ord('\\''): '\\\\u0027',\n35:     ord('\"'): '\\\\u0022',\n36:     ord('>'): '\\\\u003E',\n37:     ord('<'): '\\\\u003C',\n38:     ord('&'): '\\\\u0026',\n39:     ord('='): '\\\\u003D',\n40:     ord('-'): '\\\\u002D',\n41:     ord(';'): '\\\\u003B',\n42:     ord('`'): '\\\\u0060',\n43:     ord('\\u2028'): '\\\\u2028',\n44:     ord('\\u2029'): '\\\\u2029'\n45: }\n46: \n47: # Escape every ASCII character with a value less than 32.\n48: _js_escapes.update((ord('%c' % z), '\\\\u%04X' % z) for z in range(32))\n49: \n50: \n51: @keep_lazy(str, SafeString)\n52: def escapejs(value):\nCode replaced for brevity.\n54: \n55: \n56: \n57: _json_script_escapes = {\n58:     ord('>'): '\\\\u003E',\n59:     ord('<'): '\\\\u003C',\n60:     ord('&'): '\\\\u0026',\n61: }\n62: \n63: \n64: def json_script(value, element_id):\n65:     \"\"\"\n66:     Escape all the HTML/XML special characters with their unicode escapes, so\n67:     value is safe to be output anywhere except for inside a tag attribute. Wrap\n68:     the escaped JSON in a script tag.\n69:     \"\"\"\n70:     from django.core.serializers.json import DjangoJSONEncoder\n71:     json_str = json.dumps(value, cls=DjangoJSONEncoder).translate(_json_script_escapes)\n72:     return format_html(\n73:         '<script id=\"{}\" type=\"application/json\">{}</script>',\n74:         element_id, mark_safe(json_str)\n75:     )\n76: \n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/django/template/defaultfilters.py",
      "suspect_lines": [
        86,
        89
      ]
    },
    {
      "filename": "/django/utils/html.py",
      "suspect_lines": [
        64,
        72,
        73,
        74,
        75
      ]
    }
  ]
}