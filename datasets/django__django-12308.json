{
  "instance_id": "django__django-12308",
  "problem_statement": "JSONField are not properly displayed in admin when they are readonly.\nDescription\n\t\nJSONField values are displayed as dict when readonly in the admin.\nFor example, {\"foo\": \"bar\"} would be displayed as {'foo': 'bar'}, which is not valid JSON.\nI believe the fix would be to add a special case in django.contrib.admin.utils.display_for_field to call the prepare_value of the JSONField (not calling json.dumps directly to take care of the InvalidJSONInput case).\n",
  "localized_code": "[start of django/contrib/admin/utils.py]\n1: import datetime\n2: import decimal\n3: from collections import defaultdict\n4: \n5: from django.core.exceptions import FieldDoesNotExist\n6: from django.db import models, router\n7: from django.db.models.constants import LOOKUP_SEP\n8: from django.db.models.deletion import Collector\n9: from django.forms.utils import pretty_name\n10: from django.urls import NoReverseMatch, reverse\n11: from django.utils import formats, timezone\n12: from django.utils.html import format_html\n13: from django.utils.regex_helper import _lazy_re_compile\n14: from django.utils.text import capfirst\n15: from django.utils.translation import ngettext, override as translation_override\n16: \n17: QUOTE_MAP = {i: '_%02X' % i for i in b'\":/_#?;@&=+$,\"[]<>%\\n\\\\'}\n18: UNQUOTE_MAP = {v: chr(k) for k, v in QUOTE_MAP.items()}\n19: UNQUOTE_RE = _lazy_re_compile('_(?:%s)' % '|'.join([x[1:] for x in UNQUOTE_MAP]))\n20: \n21: \n22: class FieldIsAForeignKeyColumnName(Exception):\n23:     \"\"\"A field is a foreign key attname, i.e. <FK>_id.\"\"\"\n24:     pass\n25: \n26: \n27: def lookup_needs_distinct(opts, lookup_path):\n28:     \"\"\"\n29:     Return True if 'distinct()' should be used to query the given lookup path.\n30:     \"\"\"\n31:     lookup_fields = lookup_path.split(LOOKUP_SEP)\n32:     # Go through the fields (following all relations) and look for an m2m.\n33:     for field_name in lookup_fields:\n34:         if field_name == 'pk':\n35:             field_name = opts.pk.name\n36:         try:\n37:             field = opts.get_field(field_name)\n38:         except FieldDoesNotExist:\n39:             # Ignore query lookups.\n40:             continue\n41:         else:\n42:             if hasattr(field, 'get_path_info'):\n43:                 # This field is a relation; update opts to follow the relation.\n44:                 path_info = field.get_path_info()\n45:                 opts = path_info[-1].to_opts\n46:                 if any(path.m2m for path in path_info):\n47:                     # This field is a m2m relation so distinct must be called.\n48:                     return True\n49:     return False\n50: \n51: \n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/django/contrib/admin/utils.py",
      "suspect_lines": []
    }
  ]
}