{
  "instance_id": "django__django-11239",
  "problem_statement": "Add support for postgresql client certificates and key to dbshell.\nDescription\n\t\nThis bug is very similar to the #28322\nA common security procedure for DB access is to require mutual TLS for the DB connection.\nThis involves specifying a server certificate, client certificate, and client key when connecting.\nDjango already supports this configuration, it looks like this:\nDATABASES = {\n\t'default': {\n\t\t'ENGINE': 'django.db.backends.postgresql',\n\t\t'NAME': os.environ.get('POSTGRES_DB_NAME'),\n\t\t'USER': os.environ.get('POSTGRES_DB_USER'),\n\t\t'HOST': 'postgres',\n\t\t'PORT': '5432',\n\t\t'SCHEMA': os.environ.get('POSTGRES_DB_SCHEMA'),\n\t\t'OPTIONS': {\n\t\t\t 'sslmode': 'verify-ca',\n\t\t\t 'sslrootcert': os.environ.get('POSTGRES_CLI_SSL_CA', 'ca.crt'),\n\t\t\t 'sslcert': os.environ.get('POSTGRES_CLI_SSL_CRT', 'client_cert_chain.crt'),\n\t\t\t 'sslkey': os.environ.get('POSTGRES_CLI_SSL_KEY', 'client_key.key')\n\t\t}\n\t}\n}\nHowever the dbshell command does not support the client cert params.\nShould be a trivial fix to add in support for the other 'ssl' parameters required here.\n",
  "localized_code": "[start of django/db/backends/postgresql/client.py]\n1: import os\n2: import signal\n3: import subprocess\n4: \n5: from django.db.backends.base.client import BaseDatabaseClient\n6: \n7: \n8: class DatabaseClient(BaseDatabaseClient):\n9:     executable_name = 'psql'\n10: \n11:     @classmethod\n12:     def runshell_db(cls, conn_params):\n13:         args = [cls.executable_name]\n14: \n15:         host = conn_params.get('host', '')\n16:         port = conn_params.get('port', '')\n17:         dbname = conn_params.get('database', '')\n18:         user = conn_params.get('user', '')\n19:         passwd = conn_params.get('password', '')\n20: \n21:         if user:\n22:             args += ['-U', user]\n23:         if host:\n24:             args += ['-h', host]\n25:         if port:\n26:             args += ['-p', str(port)]\n27:         args += [dbname]\n28: \n29:         sigint_handler = signal.getsignal(signal.SIGINT)\n30:         subprocess_env = os.environ.copy()\n31:         if passwd:\n32:             subprocess_env['PGPASSWORD'] = str(passwd)\n33:         try:\n34:             # Allow SIGINT to pass to psql to abort queries.\n35:             signal.signal(signal.SIGINT, signal.SIG_IGN)\n36:             subprocess.run(args, check=True, env=subprocess_env)\n37:         finally:\n38:             # Restore the original SIGINT handler.\n39:             signal.signal(signal.SIGINT, sigint_handler)\n40: \n41:     def runshell(self):\n42:         DatabaseClient.runshell_db(self.connection.get_connection_params())\n\n",
  "line_level_localization": [
    {
      "filename": "/django/db/backends/postgresql/client.py",
      "suspect_lines": []
    }
  ]
}