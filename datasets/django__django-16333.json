{
  "instance_id": "django__django-16333",
  "problem_statement": "UserCreationForm should save data from ManyToMany form fields\nDescription\n\t\nWhen using contrib.auth.forms.UserCreationForm with a custom User model which has ManyToManyField fields, the data in all related form fields (e.g. a ModelMultipleChoiceField) is not saved. \nThis is because unlike its parent class django.forms.ModelForm, UserCreationForm.save(commit=True) omits to call self.save_m2m(). \nThis has been discussed on the #django-developers mailing list â€‹https://groups.google.com/u/1/g/django-developers/c/2jj-ecoBwE4 and I'm ready to work on a PR.\n",
  "localized_code": "[start of django/contrib/auth/forms.py]\n1: import unicodedata\n2: \n3: from django import forms\n4: from django.contrib.auth import authenticate, get_user_model, password_validation\n5: from django.contrib.auth.hashers import UNUSABLE_PASSWORD_PREFIX, identify_hasher\n6: from django.contrib.auth.models import User\n7: from django.contrib.auth.tokens import default_token_generator\n8: from django.contrib.sites.shortcuts import get_current_site\n9: from django.core.exceptions import ValidationError\n10: from django.core.mail import EmailMultiAlternatives\n11: from django.template import loader\n12: from django.utils.encoding import force_bytes\n13: from django.utils.http import urlsafe_base64_encode\n14: from django.utils.text import capfirst\n15: from django.utils.translation import gettext\n16: from django.utils.translation import gettext_lazy as _\n17: \n18: UserModel = get_user_model()\n19: \n20: \n21: def _unicode_ci_compare(s1, s2):\n22:     \"\"\"\n23:     Perform case-insensitive comparison of two identifiers, using the\n24:     recommended algorithm from Unicode Technical Report 36, section\n25:     2.11.2(B)(2).\n26:     \"\"\"\n27:     return (\n28:         unicodedata.normalize(\"NFKC\", s1).casefold()\n29:         == unicodedata.normalize(\"NFKC\", s2).casefold()\n30:     )\n31: \n32: \n33: class ReadOnlyPasswordHashWidget(forms.Widget):\n34:     template_name = \"auth/widgets/read_only_password_hash.html\"\n35:     read_only = True\n36: \n37:     def get_context(self, name, value, attrs):\n38:         context = super().get_context(name, value, attrs)\n39:         summary = []\n40:         if not value or value.startswith(UNUSABLE_PASSWORD_PREFIX):\n41:             summary.append({\"label\": gettext(\"No password set.\")})\n42:         else:\n43:             try:\n44:                 hasher = identify_hasher(value)\n45:             except ValueError:\n46:                 summary.append(\n47:                     {\n48:                         \"label\": gettext(\n49:                             \"Invalid password format or unknown hashing algorithm.\"\n50:                         )\n51:                     }\n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/django/contrib/auth/forms.py",
      "suspect_lines": []
    }
  ]
}