{
  "instance_id": "pylint-dev__pylint-7277",
  "problem_statement": "`pylint` removes first item from `sys.path` when running from `runpy`.\n### Bug description\n\nThis is the line where the first item from sys.path is removed.\r\nhttps://github.com/PyCQA/pylint/blob/ce7cccf96454fb6e286e4a8f38919733a0f28f44/pylint/__init__.py#L99\r\n\r\nI think there should be a check to ensure that the first item is `\"\"`, `\".\"` or `os.getcwd()` before removing.\n\n### Configuration\n\n_No response_\n\n### Command used\n\n```shell\nRun programmatically to repro this, using this code:\r\n\r\nimport sys\r\nimport runpy\r\n\r\nsys.path.insert(0, \"something\")\r\n\r\nrunpy.run_module('pylint', run_name=\"__main__\", alter_sys=True)\n```\n\n\n### Pylint output\n\n```shell\nWhen using pylint extension which bundles the libraries, the extension add them to sys.path depending on user settings. Pylint removes the first entry from sys path causing it to fail to load.\n```\n\n\n### Expected behavior\n\nCheck if  `\"\"`, `\".\"` or `os.getcwd()` before removing the first item from sys.path\n\n### Pylint version\n\n```shell\npylint 2.14.5\n```\n\n\n### OS / Environment\n\n_No response_\n\n### Additional dependencies\n\n_No response_\n",
  "localized_code": "[start of pylint/__init__.py]\n1: # Licensed under the GPL: https://www.gnu.org/licenses/old-licenses/gpl-2.0.html\n2: # For details: https://github.com/PyCQA/pylint/blob/main/LICENSE\n3: # Copyright (c) https://github.com/PyCQA/pylint/blob/main/CONTRIBUTORS.txt\n4: \n5: from __future__ import annotations\n6: \n7: __all__ = [\n8:     \"__version__\",\n9:     \"version\",\n10:     \"modify_sys_path\",\n11:     \"run_pylint\",\n12:     \"run_epylint\",\n13:     \"run_symilar\",\n14:     \"run_pyreverse\",\n15: ]\n16: \n17: import os\n18: import sys\n19: from collections.abc import Sequence\n20: from typing import NoReturn\n21: \n22: from pylint.__pkginfo__ import __version__\n23: \n24: # pylint: disable=import-outside-toplevel\n25: \n26: \n27: def run_pylint(argv: Sequence[str] | None = None) -> None:\n28:     \"\"\"Run pylint.\n29: \n30:     argv can be a sequence of strings normally supplied as arguments on the command line\n31:     \"\"\"\n32:     from pylint.lint import Run as PylintRun\n33: \n34:     try:\n35:         PylintRun(argv or sys.argv[1:])\n36:     except KeyboardInterrupt:\n37:         sys.exit(1)\n38: \n39: \n40: def _run_pylint_config(argv: Sequence[str] | None = None) -> None:\n41:     \"\"\"Run pylint-config.\n42: \n43:     argv can be a sequence of strings normally supplied as arguments on the command line\n44:     \"\"\"\n45:     from pylint.lint.run import _PylintConfigRun\n46: \n47:     _PylintConfigRun(argv or sys.argv[1:])\n48: \n49: \n50: def run_epylint(argv: Sequence[str] | None = None) -> NoReturn:\n51:     \"\"\"Run epylint.\n52: \n53:     argv can be a list of strings normally supplied as arguments on the command line\n54:     \"\"\"\n55:     from pylint.epylint import Run as EpylintRun\n56: \n57:     EpylintRun(argv)\n58: \n59: \n60: def run_pyreverse(argv: Sequence[str] | None = None) -> NoReturn:  # type: ignore[misc]\nCode replaced for brevity.\n67: \n68: \n69: \n70: def run_symilar(argv: Sequence[str] | None = None) -> NoReturn:\nCode replaced for brevity.\n77: \n78: \n79: \n80: def modify_sys_path() -> None:\n81:     \"\"\"Modify sys path for execution as Python module.\n82: \n83:     Strip out the current working directory from sys.path.\n84:     Having the working directory in `sys.path` means that `pylint` might\n85:     inadvertently import user code from modules having the same name as\n86:     stdlib or pylint's own modules.\n87:     CPython issue: https://bugs.python.org/issue33053\n88: \n89:     - Remove the first entry. This will always be either \"\" or the working directory\n90:     - Remove the working directory from the second and third entries\n91:       if PYTHONPATH includes a \":\" at the beginning or the end.\n92:       https://github.com/PyCQA/pylint/issues/3636\n93:       Don't remove it if PYTHONPATH contains the cwd or '.' as the entry will\n94:       only be added once.\n95:     - Don't remove the working directory from the rest. It will be included\n96:       if pylint is installed in an editable configuration (as the last item).\n97:       https://github.com/PyCQA/pylint/issues/4161\n98:     \"\"\"\n99:     sys.path.pop(0)\n100:     env_pythonpath = os.environ.get(\"PYTHONPATH\", \"\")\n101:     cwd = os.getcwd()\n102:     if env_pythonpath.startswith(\":\") and env_pythonpath not in (f\":{cwd}\", \":.\"):\n103:         sys.path.pop(0)\n104:     elif env_pythonpath.endswith(\":\") and env_pythonpath not in (f\"{cwd}:\", \".:\"):\n105:         sys.path.pop(1)\n106: \n107: \n108: version = __version__\n\n",
  "line_level_localization": [
    {
      "filename": "/pylint/__init__.py",
      "suspect_lines": [
        99,
        100
      ]
    }
  ]
}