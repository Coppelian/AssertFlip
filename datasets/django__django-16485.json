{
  "instance_id": "django__django-16485",
  "problem_statement": "floatformat() crashes on \"0.00\".\nDescription\n\t\nfrom decimal import Decimal\nfrom django.template.defaultfilters import floatformat\nfloatformat('0.00', 0)\nfloatformat(Decimal('0.00'), 0)\nBoth throw ValueError: valid range for prec is [1, MAX_PREC]\n",
  "localized_code": "[start of django/template/defaultfilters.py]\n1: \"\"\"Default variable filters.\"\"\"\n2: import random as random_module\n3: import re\n4: import types\n5: import warnings\n6: from decimal import ROUND_HALF_UP, Context, Decimal, InvalidOperation\n7: from functools import wraps\n8: from inspect import unwrap\n9: from operator import itemgetter\n10: from pprint import pformat\n11: from urllib.parse import quote\n12: \n13: from django.utils import formats\n14: from django.utils.dateformat import format, time_format\n15: from django.utils.deprecation import RemovedInDjango51Warning\n16: from django.utils.encoding import iri_to_uri\n17: from django.utils.html import avoid_wrapping, conditional_escape, escape, escapejs\n18: from django.utils.html import json_script as _json_script\n19: from django.utils.html import linebreaks, strip_tags\n20: from django.utils.html import urlize as _urlize\n21: from django.utils.safestring import SafeData, mark_safe\n22: from django.utils.text import Truncator, normalize_newlines, phone2numeric\n23: from django.utils.text import slugify as _slugify\n24: from django.utils.text import wrap\n25: from django.utils.timesince import timesince, timeuntil\n26: from django.utils.translation import gettext, ngettext\n27: \n28: from .base import VARIABLE_ATTRIBUTE_SEPARATOR\n29: from .library import Library\n30: \n31: register = Library()\n32: \n33: \n34: #######################\n35: # STRING DECORATOR    #\n36: #######################\n37: \n38: \n39: def stringfilter(func):\n40:     \"\"\"\n41:     Decorator for filters which should only receive strings. The object\n42:     passed as the first positional argument will be converted to a string.\n43:     \"\"\"\n44: \n45:     @wraps(func)\n46:     def _dec(first, *args, **kwargs):\n47:         first = str(first)\n48:         result = func(first, *args, **kwargs)\n49:         if isinstance(first, SafeData) and getattr(unwrap(func), \"is_safe\", False):\n50:             result = mark_safe(result)\n51:         return result\n52: \n53:     return _dec\n54: \n55: \n56: ###################\n57: # STRINGS         #\n58: ###################\n59: \n60: \n61: @register.filter(is_safe=True)\n62: @stringfilter\n63: def addslashes(value):\nCode replaced for brevity.\n69: \n70: \n71: \n72: @register.filter(is_safe=True)\n73: @stringfilter\n74: def capfirst(value):\nCode replaced for brevity.\n76: \n77: \n78: \n79: @register.filter(\"escapejs\")\n80: @stringfilter\n81: def escapejs_filter(value):\nCode replaced for brevity.\n83: \n84: \n85: \n86: @register.filter(is_safe=True)\n87: def json_script(value, element_id=None):\nCode replaced for brevity.\n92: \n93: \n94: \n95: @register.filter(is_safe=True)\n96: def floatformat(text, arg=-1):\n97:     \"\"\"\n98:     Display a float to a specified number of decimal places.\n99: \n100:     If called without an argument, display the floating point number with one\n101:     decimal place -- but only if there's a decimal place to be displayed:\n102: \n103:     * num1 = 34.23234\n104:     * num2 = 34.00000\n105:     * num3 = 34.26000\n106:     * {{ num1|floatformat }} displays \"34.2\"\n107:     * {{ num2|floatformat }} displays \"34\"\n108:     * {{ num3|floatformat }} displays \"34.3\"\n109: \n110:     If arg is positive, always display exactly arg number of decimal places:\n111: \n112:     * {{ num1|floatformat:3 }} displays \"34.232\"\n113:     * {{ num2|floatformat:3 }} displays \"34.000\"\n114:     * {{ num3|floatformat:3 }} displays \"34.260\"\n115: \n116:     If arg is negative, display arg number of decimal places -- but only if\n117:     there are places to be displayed:\n118: \n119:     * {{ num1|floatformat:\"-3\" }} displays \"34.232\"\n120:     * {{ num2|floatformat:\"-3\" }} displays \"34\"\n121:     * {{ num3|floatformat:\"-3\" }} displays \"34.260\"\n122: \n123:     If arg has the 'g' suffix, force the result to be grouped by the\n124:     THOUSAND_SEPARATOR for the active locale. When the active locale is\n125:     en (English):\n126: \n127:     * {{ 6666.6666|floatformat:\"2g\" }} displays \"6,666.67\"\n128:     * {{ 10000|floatformat:\"g\" }} displays \"10,000\"\n129: \n130:     If arg has the 'u' suffix, force the result to be unlocalized. When the\n131:     active locale is pl (Polish):\n132: \n133:     * {{ 66666.6666|floatformat:\"2\" }} displays \"66666,67\"\n134:     * {{ 66666.6666|floatformat:\"2u\" }} displays \"66666.67\"\n135: \n136:     If the input float is infinity or NaN, display the string representation\n137:     of that value.\n138:     \"\"\"\n139:     force_grouping = False\n140:     use_l10n = True\n141:     if isinstance(arg, str):\n142:         last_char = arg[-1]\n143:         if arg[-2:] in {\"gu\", \"ug\"}:\n144:             force_grouping = True\n145:             use_l10n = False\n146:             arg = arg[:-2] or -1\n147:         elif last_char == \"g\":\n148:             force_grouping = True\n149:             arg = arg[:-1] or -1\n150:         elif last_char == \"u\":\n151:             use_l10n = False\n152:             arg = arg[:-1] or -1\n153:     try:\n154:         input_val = str(text)\n155:         d = Decimal(input_val)\n156:     except InvalidOperation:\n157:         try:\n158:             d = Decimal(str(float(text)))\n159:         except (ValueError, InvalidOperation, TypeError):\n160:             return \"\"\n161:     try:\n162:         p = int(arg)\n163:     except ValueError:\n164:         return input_val\n165: \n166:     try:\n167:         m = int(d) - d\n168:     except (ValueError, OverflowError, InvalidOperation):\n169:         return input_val\n170: \n171:     if not m and p < 0:\n172:         return mark_safe(\n173:             formats.number_format(\n174:                 \"%d\" % (int(d)),\n175:                 0,\n176:                 use_l10n=use_l10n,\n177:                 force_grouping=force_grouping,\n178:             )\n179:         )\n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/django/template/defaultfilters.py",
      "suspect_lines": [
        171
      ]
    }
  ]
}