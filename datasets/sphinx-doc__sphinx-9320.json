{
  "instance_id": "sphinx-doc__sphinx-9320",
  "problem_statement": "`sphinx-quickstart` with existing conf.py doesn't exit easily\n**Describe the bug**\r\nI've attached a screenshot in the screenshots section which I think explains the bug better.\r\n\r\n- I'm running `sphinx-quickstart` in a folder with a conf.py already existing. \r\n- It says *\"Please enter a new root path name (or just Enter to exit)\"*. \r\n- However, upon pressing 'Enter' it returns an error message *\"Please enter a valid path name\"*. \r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n```\r\n$ sphinx-quickstart\r\n$ sphinx-quickstart\r\n```\r\n\r\n**Expected behavior**\r\nAfter pressing Enter, sphinx-quickstart exits. \r\n\r\n**Your project**\r\nn/a\r\n\r\n**Screenshots**\r\n\r\n![sphinx-enter-exit](https://user-images.githubusercontent.com/30437511/121676712-4bf54f00-caf8-11eb-992b-636e56999d54.png)\r\nI press Enter for the first prompt.\r\n\r\n\r\n**Environment info**\r\n- OS: Ubuntu 20.04\r\n- Python version: Python 3.8.5\r\n- Sphinx version: sphinx-build 3.2.1 \r\n- Sphinx extensions:  none\r\n- Extra tools: none\r\n\r\n**Additional context**\r\nI had a quick search but couldn't find any similar existing issues. Sorry if this is a duplicate.\r\n\n",
  "localized_code": "[start of sphinx/cmd/quickstart.py]\n1: \"\"\"\n2:     sphinx.cmd.quickstart\n3:     ~~~~~~~~~~~~~~~~~~~~~\n4: \n5:     Quickly setup documentation source to work with Sphinx.\n6: \n7:     :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.\n8:     :license: BSD, see LICENSE for details.\n9: \"\"\"\n10: \n11: import argparse\n12: import locale\n13: import os\n14: import sys\n15: import time\n16: from collections import OrderedDict\n17: from os import path\n18: from typing import Any, Callable, Dict, List, Union\n19: \n20: # try to import readline, unix specific enhancement\n21: try:\n22:     import readline\n23:     if readline.__doc__ and 'libedit' in readline.__doc__:\n24:         readline.parse_and_bind(\"bind ^I rl_complete\")\n25:         USE_LIBEDIT = True\n26:     else:\n27:         readline.parse_and_bind(\"tab: complete\")\n28:         USE_LIBEDIT = False\n29: except ImportError:\n30:     readline = None\n31:     USE_LIBEDIT = False\n32: \n33: from docutils.utils import column_width\n34: \n35: import sphinx.locale\n36: from sphinx import __display_version__, package_dir\n37: from sphinx.locale import __\n38: from sphinx.util.console import bold, color_terminal, colorize, nocolor, red  # type: ignore\n39: from sphinx.util.osutil import ensuredir\n40: from sphinx.util.template import SphinxRenderer\n41: \n42: EXTENSIONS = OrderedDict([\n43:     ('autodoc', __('automatically insert docstrings from modules')),\n44:     ('doctest', __('automatically test code snippets in doctest blocks')),\n45:     ('intersphinx', __('link between Sphinx documentation of different projects')),\n46:     ('todo', __('write \"todo\" entries that can be shown or hidden on build')),\n47:     ('coverage', __('checks for documentation coverage')),\n48:     ('imgmath', __('include math, rendered as PNG or SVG images')),\n49:     ('mathjax', __('include math, rendered in the browser by MathJax')),\n50:     ('ifconfig', __('conditional inclusion of content based on config values')),\n51:     ('viewcode', __('include links to the source code of documented Python objects')),\n52:     ('githubpages', __('create .nojekyll file to publish the document on GitHub pages')),\n53: ])\n54: \n55: DEFAULTS = {\n56:     'path': '.',\n57:     'sep': False,\n58:     'dot': '_',\n59:     'language': None,\n60:     'suffix': '.rst',\n61:     'master': 'index',\n62:     'makefile': True,\n63:     'batchfile': True,\n64: }\n65: \n66: PROMPT_PREFIX = '> '\n67: \n68: if sys.platform == 'win32':\n69:     # On Windows, show questions as bold because of color scheme of PowerShell (refs: #5294).\n70:     COLOR_QUESTION = 'bold'\n71: else:\n72:     COLOR_QUESTION = 'purple'\n73: \n74: \n75: # function to get input from terminal -- overridden by the test suite\n76: def term_input(prompt: str) -> str:\nCode replaced for brevity.\n84: \n85: \n86: \n87: class ValidationError(Exception):\n88:     \"\"\"Raised for validation errors.\"\"\"\n89: \n90: \n91: def is_path(x: str) -> str:\nCode replaced for brevity.\n95: \n96: \n97: \n98: def allow_empty(x: str) -> str:\n99:     return x\n100: \n101: \n102: def nonempty(x: str) -> str:\nCode replaced for brevity.\n105: \n106: \n107: \n108: def choice(*l: str) -> Callable[[str], str]:\nCode replaced for brevity.\n113: \n114: \n115: \n116: def boolean(x: str) -> bool:\nCode replaced for brevity.\n119: \n120: \n121: \n122: def suffix(x: str) -> str:\nCode replaced for brevity.\n125: \n126: \n127: \n128: def ok(x: str) -> str:\n129:     return x\n130: \n131: \n132: def do_prompt(text: str, default: str = None, validator: Callable[[str], Any] = nonempty) -> Union[str, bool]:  # NOQA\nCode replaced for brevity.\n157: \n158: \n159: \n160: class QuickstartRenderer(SphinxRenderer):\nCode replaced for brevity.\n182: \n183: \n184: \n185: def ask_user(d: Dict) -> None:\n186:     \"\"\"Ask the user for quickstart values missing from *d*.\n187: \n188:     Values are:\n189: \n190:     * path:      root path\n191:     * sep:       separate source and build dirs (bool)\n192:     * dot:       replacement for dot in _templates etc.\n193:     * project:   project name\n194:     * author:    author names\n195:     * version:   version of project\n196:     * release:   release of project\n197:     * language:  document language\n198:     * suffix:    source file suffix\n199:     * master:    master document name\n200:     * extensions:  extensions to use (list)\n201:     * makefile:  make Makefile\n202:     * batchfile: make command file\n203:     \"\"\"\n204: \n205:     print(bold(__('Welcome to the Sphinx %s quickstart utility.')) % __display_version__)\n206:     print()\n207:     print(__('Please enter values for the following settings (just press Enter to\\n'\n208:              'accept a default value, if one is given in brackets).'))\n209: \n210:     if 'path' in d:\n211:         print()\n212:         print(bold(__('Selected root path: %s')) % d['path'])\n213:     else:\n214:         print()\n215:         print(__('Enter the root path for documentation.'))\n216:         d['path'] = do_prompt(__('Root path for the documentation'), '.', is_path)\n217: \n218:     while path.isfile(path.join(d['path'], 'conf.py')) or \\\n219:             path.isfile(path.join(d['path'], 'source', 'conf.py')):\n220:         print()\n221:         print(bold(__('Error: an existing conf.py has been found in the '\n222:                       'selected root path.')))\n223:         print(__('sphinx-quickstart will not overwrite existing Sphinx projects.'))\n224:         print()\n225:         d['path'] = do_prompt(__('Please enter a new root path (or just Enter to exit)'),\n226:                               '', is_path)\n227:         if not d['path']:\n228:             sys.exit(1)\n229: \n230:     if 'sep' not in d:\n231:         print()\n232:         print(__('You have two options for placing the build directory for Sphinx output.\\n'\n233:                  'Either, you use a directory \"_build\" within the root path, or you separate\\n'\n234:                  '\"source\" and \"build\" directories within the root path.'))\n235:         d['sep'] = do_prompt(__('Separate source and build directories (y/n)'), 'n', boolean)\n236: \n237:     if 'dot' not in d:\n238:         print()\n239:         print(__('Inside the root directory, two more directories will be created; \"_templates\"\\n'      # NOQA\n240:                  'for custom HTML templates and \"_static\" for custom stylesheets and other static\\n'    # NOQA\n241:                  'files. You can enter another prefix (such as \".\") to replace the underscore.'))       # NOQA\n242:         d['dot'] = do_prompt(__('Name prefix for templates and static dir'), '_', ok)\n243: \n244:     if 'project' not in d:\n245:         print()\n246:         print(__('The project name will occur in several places in the built documentation.'))\n247:         d['project'] = do_prompt(__('Project name'))\n248:     if 'author' not in d:\n249:         d['author'] = do_prompt(__('Author name(s)'))\n250: \n251:     if 'version' not in d:\n252:         print()\n253:         print(__('Sphinx has the notion of a \"version\" and a \"release\" for the\\n'\n254:                  'software. Each version can have multiple releases. For example, for\\n'\n255:                  'Python the version is something like 2.5 or 3.0, while the release is\\n'\n256:                  'something like 2.5.1 or 3.0a1. If you don\\'t need this dual structure,\\n'\n257:                  'just set both to the same value.'))\n258:         d['version'] = do_prompt(__('Project version'), '', allow_empty)\n259:     if 'release' not in d:\n260:         d['release'] = do_prompt(__('Project release'), d['version'], allow_empty)\n261: \n262:     if 'language' not in d:\n263:         print()\n264:         print(__('If the documents are to be written in a language other than English,\\n'\n265:                  'you can select a language here by its language code. Sphinx will then\\n'\n266:                  'translate text that it generates into that language.\\n'\n267:                  '\\n'\n268:                  'For a list of supported codes, see\\n'\n269:                  'https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-language.'))  # NOQA\n270:         d['language'] = do_prompt(__('Project language'), 'en')\n271:         if d['language'] == 'en':\n272:             d['language'] = None\n273: \n274:     if 'suffix' not in d:\n275:         print()\n276:         print(__('The file name suffix for source files. Commonly, this is either \".txt\"\\n'\n277:                  'or \".rst\". Only files with this suffix are considered documents.'))\n278:         d['suffix'] = do_prompt(__('Source file suffix'), '.rst', suffix)\n279: \n280:     if 'master' not in d:\n281:         print()\n282:         print(__('One document is special in that it is considered the top node of the\\n'\n283:                  '\"contents tree\", that is, it is the root of the hierarchical structure\\n'\n284:                  'of the documents. Normally, this is \"index\", but if your \"index\"\\n'\n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/sphinx/cmd/quickstart.py",
      "suspect_lines": [
        226
      ]
    }
  ]
}