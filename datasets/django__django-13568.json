{
  "instance_id": "django__django-13568",
  "problem_statement": "Skip auth.E003 system check for USERNAME_FIELD with total UniqueConstraints.\nDescription\n\t\nDefining a user model like this:\nclass User(AbstractBaseUser):\n\tusername = models.CharField(max_length=30)\n\tUSERNAME_FIELD = \"username\"\n\tclass Meta:\n\t\tconstraints = [UniqueConstraint(fields=[\"username\"], name=\"user_username_unq\")]\nWill trigger auth.E003:\nauth.User: (auth.E003) 'User.username' must be unique because it is named as the 'USERNAME_FIELD'.\nSometimes itâ€™s not preferable to set the field as unique with unique=True as it will create an extra implicit *_like index for CharField and TextField on PostgresSQL. The system check should be extended to check for the presence of USERNAME_FIELD in Model._meta.constraints. Not really sure if this classifies as a bug.\n",
  "localized_code": "[start of django/contrib/auth/checks.py]\n1: from itertools import chain\n2: from types import MethodType\n3: \n4: from django.apps import apps\n5: from django.conf import settings\n6: from django.core import checks\n7: \n8: from .management import _get_builtin_permissions\n9: \n10: \n11: def check_user_model(app_configs=None, **kwargs):\n12:     if app_configs is None:\n13:         cls = apps.get_model(settings.AUTH_USER_MODEL)\n14:     else:\n15:         app_label, model_name = settings.AUTH_USER_MODEL.split('.')\n16:         for app_config in app_configs:\n17:             if app_config.label == app_label:\n18:                 cls = app_config.get_model(model_name)\n19:                 break\n20:         else:\n21:             # Checks might be run against a set of app configs that don't\n22:             # include the specified user model. In this case we simply don't\n23:             # perform the checks defined below.\n24:             return []\n25: \n26:     errors = []\n27: \n28:     # Check that REQUIRED_FIELDS is a list\n29:     if not isinstance(cls.REQUIRED_FIELDS, (list, tuple)):\n30:         errors.append(\n31:             checks.Error(\n32:                 \"'REQUIRED_FIELDS' must be a list or tuple.\",\n33:                 obj=cls,\n34:                 id='auth.E001',\n35:             )\n36:         )\n37: \n38:     # Check that the USERNAME FIELD isn't included in REQUIRED_FIELDS.\n39:     if cls.USERNAME_FIELD in cls.REQUIRED_FIELDS:\n40:         errors.append(\n41:             checks.Error(\n42:                 \"The field named as the 'USERNAME_FIELD' \"\n43:                 \"for a custom user model must not be included in 'REQUIRED_FIELDS'.\",\n44:                 hint=(\n45:                     \"The 'USERNAME_FIELD' is currently set to '%s', you \"\n46:                     \"should remove '%s' from the 'REQUIRED_FIELDS'.\"\n47:                     % (cls.USERNAME_FIELD, cls.USERNAME_FIELD)\n48:                 ),\n49:                 obj=cls,\n50:                 id='auth.E002',\n51:             )\n52:         )\n53: \n54:     # Check that the username field is unique\n55:     if not cls._meta.get_field(cls.USERNAME_FIELD).unique:\n56:         if (settings.AUTHENTICATION_BACKENDS ==\n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/django/contrib/auth/checks.py",
      "suspect_lines": [
        55
      ]
    }
  ]
}