{
  "instance_id": "psf__requests-2931",
  "problem_statement": "Request with binary payload fails due to calling to_native_string\nIntroduced with https://github.com/kennethreitz/requests/issues/2844\n\n```\nimport requests\nrequests.put(\"http://httpbin.org/put\", data=u\"ööö\".encode(\"utf-8\"))\n```\n\nThis works with 2.8.1, but not with 2.9.\n\n",
  "localized_code": "[start of requests/models.py]\n1: # -*- coding: utf-8 -*-\n2: \n3: \"\"\"\n4: requests.models\n5: ~~~~~~~~~~~~~~~\n6: \n7: This module contains the primary objects that power Requests.\n8: \"\"\"\n9: \n10: import collections\n11: import datetime\n12: \n13: from io import BytesIO, UnsupportedOperation\n14: from .hooks import default_hooks\n15: from .structures import CaseInsensitiveDict\n16: \n17: from .auth import HTTPBasicAuth\n18: from .cookies import cookiejar_from_dict, get_cookie_header, _copy_cookie_jar\n19: from .packages.urllib3.fields import RequestField\n20: from .packages.urllib3.filepost import encode_multipart_formdata\n21: from .packages.urllib3.util import parse_url\n22: from .packages.urllib3.exceptions import (\n23:     DecodeError, ReadTimeoutError, ProtocolError, LocationParseError)\n24: from .exceptions import (\n25:     HTTPError, MissingSchema, InvalidURL, ChunkedEncodingError,\n26:     ContentDecodingError, ConnectionError, StreamConsumedError)\n27: from .utils import (\n28:     guess_filename, get_auth_from_url, requote_uri,\n29:     stream_decode_response_unicode, to_key_val_list, parse_header_links,\n30:     iter_slices, guess_json_utf, super_len, to_native_string)\n31: from .compat import (\n32:     cookielib, urlunparse, urlsplit, urlencode, str, bytes, StringIO,\n33:     is_py2, chardet, builtin_str, basestring)\n34: from .compat import json as complexjson\n35: from .status_codes import codes\n36: \n37: #: The set of HTTP status codes that indicate an automatically\n38: #: processable redirect.\n39: REDIRECT_STATI = (\n40:     codes.moved,              # 301\n41:     codes.found,              # 302\n42:     codes.other,              # 303\n43:     codes.temporary_redirect, # 307\n44:     codes.permanent_redirect, # 308\n45: )\n46: \n47: DEFAULT_REDIRECT_LIMIT = 30\n48: CONTENT_CHUNK_SIZE = 10 * 1024\n49: ITER_CHUNK_SIZE = 512\n50: \n51: \n52: class RequestEncodingMixin(object):\n53:     @property\n54:     def path_url(self):\n55:         \"\"\"Build the path URL to use.\"\"\"\n56: \n57:         url = []\n58: \n59:         p = urlsplit(self.url)\n60: \n61:         path = p.path\n62:         if not path:\n63:             path = '/'\n64: \n65:         url.append(path)\n66: \n67:         query = p.query\n68:         if query:\n69:             url.append('?')\n70:             url.append(query)\n71: \n72:         return ''.join(url)\n73: \n74:     @staticmethod\n75:     def _encode_params(data):\n76:         \"\"\"Encode parameters in a piece of data.\n77: \n78:         Will successfully encode parameters when passed as a dict or a list of\n79:         2-tuples. Order is retained if data is a list of 2-tuples but arbitrary\n80:         if parameters are supplied as a dict.\n81:         \"\"\"\n82: \n83:         if isinstance(data, (str, bytes)):\n84:             return to_native_string(data)\n85:         elif hasattr(data, 'read'):\n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/requests/models.py",
      "suspect_lines": [
        84
      ]
    }
  ]
}