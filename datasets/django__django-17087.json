{
  "instance_id": "django__django-17087",
  "problem_statement": "Class methods from nested classes cannot be used as Field.default.\nDescription\n\t \n\t\t(last modified by Mariusz Felisiak)\n\t \nGiven the following model:\n \nclass Profile(models.Model):\n\tclass Capability(models.TextChoices):\n\t\tBASIC = (\"BASIC\", \"Basic\")\n\t\tPROFESSIONAL = (\"PROFESSIONAL\", \"Professional\")\n\t\t\n\t\t@classmethod\n\t\tdef default(cls) -> list[str]:\n\t\t\treturn [cls.BASIC]\n\tcapabilities = ArrayField(\n\t\tmodels.CharField(choices=Capability.choices, max_length=30, blank=True),\n\t\tnull=True,\n\t\tdefault=Capability.default\n\t)\nThe resulting migration contained the following:\n # ...\n\t migrations.AddField(\n\t\t model_name='profile',\n\t\t name='capabilities',\n\t\t field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(blank=True, choices=[('BASIC', 'Basic'), ('PROFESSIONAL', 'Professional')], max_length=30), default=appname.models.Capability.default, null=True, size=None),\n\t ),\n # ...\nAs you can see, migrations.AddField is passed as argument \"default\" a wrong value \"appname.models.Capability.default\", which leads to an error when trying to migrate. The right value should be \"appname.models.Profile.Capability.default\".\n",
  "localized_code": "[start of django/db/migrations/serializer.py]\n1: import builtins\n2: import collections.abc\n3: import datetime\n4: import decimal\n5: import enum\n6: import functools\n7: import math\n8: import os\n9: import pathlib\n10: import re\n11: import types\n12: import uuid\n13: \n14: from django.conf import SettingsReference\n15: from django.db import models\n16: from django.db.migrations.operations.base import Operation\n17: from django.db.migrations.utils import COMPILED_REGEX_TYPE, RegexObject\n18: from django.utils.functional import LazyObject, Promise\n19: from django.utils.version import PY311, get_docs_version\n20: \n21: \n22: class BaseSerializer:\n23:     def __init__(self, value):\n24:         self.value = value\n25: \n26:     def serialize(self):\n27:         raise NotImplementedError(\n28:             \"Subclasses of BaseSerializer must implement the serialize() method.\"\n29:         )\n30: \n31: \n32: class BaseSequenceSerializer(BaseSerializer):\n33:     def _format(self):\n34:         raise NotImplementedError(\n35:             \"Subclasses of BaseSequenceSerializer must implement the _format() method.\"\n36:         )\n37: \n38:     def serialize(self):\n39:         imports = set()\n40:         strings = []\n41:         for item in self.value:\n42:             item_string, item_imports = serializer_factory(item).serialize()\n43:             imports.update(item_imports)\n44:             strings.append(item_string)\n45:         value = self._format()\n46:         return value % (\", \".join(strings)), imports\n47: \n48: \n49: class BaseUnorderedSequenceSerializer(BaseSequenceSerializer):\n50:     def __init__(self, value):\n51:         super().__init__(sorted(value, key=repr))\n52: \n53: \n54: class BaseSimpleSerializer(BaseSerializer):\nCode replaced for brevity.\n56: \n57: \n58: \n59: class ChoicesSerializer(BaseSerializer):\nCode replaced for brevity.\n61: \n62: \n63: \n64: class DateTimeSerializer(BaseSerializer):\nCode replaced for brevity.\n68: \n69: \n70: \n71: class DatetimeDatetimeSerializer(BaseSerializer):\nCode replaced for brevity.\n78: \n79: \n80: \n81: class DecimalSerializer(BaseSerializer):\nCode replaced for brevity.\n83: \n84: \n85: \n86: class DeconstructableSerializer(BaseSerializer):\nCode replaced for brevity.\n113: \n114: \n115: \n116: class DictionarySerializer(BaseSerializer):\nCode replaced for brevity.\n126: \n127: \n128: \n129: class EnumSerializer(BaseSerializer):\nCode replaced for brevity.\n149: \n150: \n151: \n152: class FloatSerializer(BaseSimpleSerializer):\nCode replaced for brevity.\n156: \n157: \n158: \n159: class FrozensetSerializer(BaseUnorderedSequenceSerializer):\nCode replaced for brevity.\n161: \n162: \n163: \n164: class FunctionTypeSerializer(BaseSerializer):\n165:     def serialize(self):\n166:         if getattr(self.value, \"__self__\", None) and isinstance(\n167:             self.value.__self__, type\n168:         ):\n169:             klass = self.value.__self__\n170:             module = klass.__module__\n171:             return \"%s.%s.%s\" % (module, klass.__name__, self.value.__name__), {\n172:                 \"import %s\" % module\n173:             }\n174:         # Further error checking\n175:         if self.value.__name__ == \"<lambda>\":\n176:             raise ValueError(\"Cannot serialize function: lambda\")\n177:         if self.value.__module__ is None:\n178:             raise ValueError(\"Cannot serialize function %r: No module\" % self.value)\n179: \n180:         module_name = self.value.__module__\n181: \n182:         if \"<\" not in self.value.__qualname__:  # Qualname can include <locals>\n183:             return \"%s.%s\" % (module_name, self.value.__qualname__), {\n184:                 \"import %s\" % self.value.__module__\n185:             }\n186: \n187:         raise ValueError(\n188:             \"Could not find function %s in %s.\\n\" % (self.value.__name__, module_name)\n189:         )\n190: \n191: \n192: class FunctoolsPartialSerializer(BaseSerializer):\nCode replaced for brevity.\n211: \n212: \n213: \n214: class IterableSerializer(BaseSerializer):\nCode replaced for brevity.\n225: \n226: \n227: \n228: class ModelFieldSerializer(DeconstructableSerializer):\nCode replaced for brevity.\n231: \n232: \n233: \n234: class ModelManagerSerializer(DeconstructableSerializer):\nCode replaced for brevity.\n241: \n242: \n243: \n244: class OperationSerializer(BaseSerializer):\nCode replaced for brevity.\n250: \n251: \n252: \n253: class PathLikeSerializer(BaseSerializer):\nCode replaced for brevity.\n255: \n256: \n257: \n258: class PathSerializer(BaseSerializer):\nCode replaced for brevity.\n263: \n264: \n265: \n266: class RegexSerializer(BaseSerializer):\nCode replaced for brevity.\n279: \n280: \n281: \n282: class SequenceSerializer(BaseSequenceSerializer):\n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/django/db/migrations/serializer.py",
      "suspect_lines": [
        171
      ]
    }
  ]
}