{
  "instance_id": "sphinx-doc__sphinx-8551",
  "problem_statement": ":type: and :rtype: gives false ambiguous class lookup warnings\n**Describe the bug**\r\nThe implicit xrefs created by the info fields ``:type:`` and ``:rtype:`` seems to do lookup differently than explicit xref roles. For unqualified names it seems like they search for the name in every (sub)module instead of in the current module and then parent modules.\r\n\r\n**To Reproduce**\r\n```rst\r\n.. py:class:: mod.A\r\n.. py:class:: mod.submod.A\r\n\r\n.. py:function:: f()\r\n\r\n\t- :py:class:`mod.A`\r\n\t- :py:class:`mod.submod.A`\r\n\r\n\t:param mod.A a:\r\n\t:param mod.submod.A b:\r\n\t:rtype: mod.A\r\n\t:rtype: mod.submod.A\r\n\r\n.. py:currentmodule:: mod\r\n\r\n.. py:function:: f()\r\n\r\n\t- :py:class:`A`\r\n\t- :py:class:`mod.A`\r\n\t- :py:class:`mod.submod.A`\r\n\r\n\t:param A a:\r\n\t:param mod.A b:\r\n\t:param mod.submod.A c:\r\n\t:rtype: A\r\n\t:rtype: mod.A\r\n\t:rtype: mod.submod.A\r\n\r\n.. py:currentmodule:: mod.submod\r\n\r\n.. py:function:: f()\r\n\r\n\t- :py:class:`A`\r\n\t- :py:class:`mod.A`\r\n\t- :py:class:`mod.submod.A`\r\n\r\n\t:param A a: BUG: links to mod.A instead of mod.submod.A\r\n\t:param mod.A b:\r\n\t:param mod.submod.A c:\r\n\t:rtype: A\r\n\t:rtype: mod.A\r\n\t:rtype: mod.submod.A\r\n```\r\ngives the warnings\r\n```\r\nindex.rst:28: WARNING: more than one target found for cross-reference 'A': mod.A, mod.submod.A\r\nindex.rst:28: WARNING: more than one target found for cross-reference 'A': mod.A, mod.submod.A\r\nindex.rst:43: WARNING: more than one target found for cross-reference 'A': mod.A, mod.submod.A\r\nindex.rst:43: WARNING: more than one target found for cross-reference 'A': mod.A, mod.submod.A\r\n```\r\nwhich refer to the 4 unqualified type names ``A``.\r\nThe ``:param:`` annotated with ``BUG`` as well as the corresponding ``rtype`` gets resolved to ``mod.A``.\r\n\r\n**Expected behavior**\r\nNo warnings, and the two mentioned types should resolve to ``mod.submod.A``.\r\n\r\n**Environment info**\r\n- Sphinx version: tested both with v3.3 and with master\n",
  "localized_code": "[start of sphinx/domains/python.py]\n1: \"\"\"\n2:     sphinx.domains.python\n3:     ~~~~~~~~~~~~~~~~~~~~~\n4: \n5:     The Python domain.\n6: \n7:     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.\n8:     :license: BSD, see LICENSE for details.\n9: \"\"\"\n10: \n11: import builtins\n12: import inspect\n13: import re\n14: import sys\n15: import typing\n16: import warnings\n17: from inspect import Parameter\n18: from typing import Any, Dict, Iterable, Iterator, List, NamedTuple, Tuple, cast\n19: \n20: from docutils import nodes\n21: from docutils.nodes import Element, Node\n22: from docutils.parsers.rst import directives\n23: \n24: from sphinx import addnodes\n25: from sphinx.addnodes import desc_signature, pending_xref\n26: from sphinx.application import Sphinx\n27: from sphinx.builders import Builder\n28: from sphinx.deprecation import RemovedInSphinx40Warning, RemovedInSphinx50Warning\n29: from sphinx.directives import ObjectDescription\n30: from sphinx.domains import Domain, Index, IndexEntry, ObjType\n31: from sphinx.environment import BuildEnvironment\n32: from sphinx.locale import _, __\n33: from sphinx.pycode.ast import ast\n34: from sphinx.pycode.ast import parse as ast_parse\n35: from sphinx.roles import XRefRole\n36: from sphinx.util import logging\n37: from sphinx.util.docfields import Field, GroupedField, TypedField\n38: from sphinx.util.docutils import SphinxDirective\n39: from sphinx.util.inspect import signature_from_str\n40: from sphinx.util.nodes import make_id, make_refnode\n41: from sphinx.util.typing import TextlikeNode\n42: \n43: if False:\n44:     # For type annotation\n45:     from typing import Type  # for python3.5.1\n46: \n47: \n48: logger = logging.getLogger(__name__)\n49: \n50: \n51: # REs for Python signatures\n... Code Truncated ...\n\n[start of sphinx/util/docfields.py]\n1: \"\"\"\n2:     sphinx.util.docfields\n3:     ~~~~~~~~~~~~~~~~~~~~~\n4: \n5:     \"Doc fields\" are reST field lists in object descriptions that will\n6:     be domain-specifically transformed to a more appealing presentation.\n7: \n8:     :copyright: Copyright 2007-2020 by the Sphinx team, see AUTHORS.\n9:     :license: BSD, see LICENSE for details.\n10: \"\"\"\n11: \n12: import warnings\n13: from typing import Any, Dict, List, Tuple, Union, cast\n14: \n15: from docutils import nodes\n16: from docutils.nodes import Node\n17: \n18: from sphinx import addnodes\n19: from sphinx.deprecation import RemovedInSphinx40Warning\n20: from sphinx.util.typing import TextlikeNode\n21: \n22: if False:\n23:     # For type annotation\n24:     from typing import Type  # for python3.5.1\n25: \n26:     from sphinx.directive import ObjectDescription\n27:     from sphinx.environment import BuildEnvironment\n28: \n29: \n30: def _is_single_paragraph(node: nodes.field_body) -> bool:\n31:     \"\"\"True if the node only contains one paragraph (and system messages).\"\"\"\n32:     if len(node) == 0:\n33:         return False\n34:     elif len(node) > 1:\n35:         for subnode in node[1:]:  # type: nodes.Node\n36:             if not isinstance(subnode, nodes.system_message):\n37:                 return False\n38:     if isinstance(node[0], nodes.paragraph):\n39:         return True\n40:     return False\n41: \n42: \n43: class Field:\n44:     \"\"\"A doc field that is never grouped.  It can have an argument or not, the\n45:     argument can be linked using a specified *rolename*.  Field should be used\n46:     for doc fields that usually don't occur more than once.\n47: \n48:     The body can be linked using a specified *bodyrolename* if the content is\n49:     just a single inline or text node.\n50: \n51:     Example::\n... Code Truncated ...\n\n",
  "line_level_localization": [
    {
      "filename": "/sphinx/domains/python.py",
      "suspect_lines": []
    },
    {
      "filename": "/sphinx/util/docfields.py",
      "suspect_lines": []
    }
  ]
}